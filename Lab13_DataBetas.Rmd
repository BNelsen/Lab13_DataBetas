---
title: "Data Betas Lab 13"
author: "Brandon Nelsen. David Washburn, Burke Parent, Drew Hoffman, Tanner Ball"
date: "2019/11/19"
output: html_document
---
```{r}
#Lab Tasks

#Each lab member should come up with and address a subquestion, and then each team should consolidate the findings and choose a single overall question that is most interesting.

#Each team member will be required to perform a permutation test so each team member should choose a subquestion that lends itself to being analyzed via a permutation test.

#Each team member will also be required to use at least one map function in their analysis from section 21.5 in R for Data Science. This does not have to be the main finding, but can be part of the exploratory analysis.

#Note that you may investigate other data sets if you feel that they pose more interesting questions. As long as you perform the above tasks in your analysis, any data sets from gapminder are okay to explore.
```



```{r, include = F, echo = F}
library(tidyverse)
library(gapminder)
```

Drew 

Do countries with higher life expectancy use more or less oil per capita than countries with a lower life expectancy?

Null hypothesis: There is no difference between oil consumption per capita based on life expectancy.

Alternative: There is a difference in oil consumption per capita based on a country's life expectancy.

My test statistic is the difference in sample means of consumption per capita between two countries, one with higher life expectancy and one with lower. My higher life expectancy countries are Japan (82.603), Switzerland (81.701), and Canada (80.653). My lower expectancy countries are Trinidad and Tobago (69.819), South Africa (49.339), and Pakistan (65.483).

In two of the histogram results (Switzerland vs. South Africa and Canada vs. Pakistan) the real difference in sample means is in the 99th percentile of results. Therefore, I can reject the null hypothesis and can conclude that in countries with a higher life expectancy, they consume more oil per capita than in countries with lower life expectancy.

```{r}
oilPerCap <- read.csv("oil_consumption_per_cap.csv")
oilPerCap_noNA <- na.omit(oilPerCap)

#map function to calculate average yearly oil consumption by country
countryAverages <- map_dbl(oilPerCap_noNA, mean)

lifeExp <- gapminder %>%
  filter(year == 2007)
#I picked 3 countries from each category, high life expectancy and low life expectancy in 2007 and plotted them against each other
#High life exp: Japan, Switzerland, Canada
#Low life exp: Trinidad and Tobago, South Africa, Pakistan

#Japan vs Trinidad and Tobago
opc_1 <- oilPerCap_noNA[c(27,50),]
#Switzerland vs South Africa
opc_2 <- oilPerCap_noNA[c(48,44),]
#Canada vs Pakistan
opc_3 <- oilPerCap_noNA[c(8,34),]

#Unlists data values for perm tests
all1 <- unlist(opc_1)
all1 <- all1[3:106]
all2 <- unlist(opc_2)
all2 <- all2[3:106]
all3 <- unlist(opc_3)
all3 <- all3[3:106]

#running permutation test
rand1 <- perm_mean(1000, all1, 52)
rand2 <- perm_mean(1000, all2, 52)
rand3 <- perm_mean(1000, all3, 52)

#Getting real mean values for each country
jap <- oilPerCap_noNA[27,]
jap <- unlist(jap)
jap <- jap[2:53]
jap <- mean(jap)
swi <- oilPerCap_noNA[48,]
swi <- unlist(swi)
swi <- swi[2:53]
swi <- mean(swi)
can <- oilPerCap_noNA[8,]
can <- unlist(can)
can <- can[2:53]
can <- mean(can)
tri <- oilPerCap_noNA[50,]
tri <- unlist(tri)
tri <- tri[2:53]
tri <- mean(tri)
sou <- oilPerCap_noNA[44,]
sou <- unlist(sou)
sou <- sou[2:53]
sou <- mean(sou)
pak <- oilPerCap_noNA[34,]
pak <- unlist(pak)
pak <- pak[2:53]
pak <- mean(pak)

#calculating difference in means
diff1 <- jap - tri
diff2 <- swi - sou
diff3 <- can - pak

#plot of perm test vs difference in sample means
ggplot() + geom_histogram(aes(rand1)) +
  geom_vline(xintercept = diff1) +
  ggtitle("Japan vs. Trinidad and Tobago: Oil Consumption Per Capita") +
  xlab("Difference in Means")
ggplot() + geom_histogram(aes(rand2)) +
  geom_vline(xintercept = diff2) +
  ggtitle("Switzerland vs. South Africa: Oil Consumption Per Capita")  +
  xlab("Difference in Means")
ggplot() + geom_histogram(aes(rand3)) +
  geom_vline(xintercept = diff3) +
  ggtitle("Canada vs. Pakistan: Oil Consumption Per Capita")  +
  xlab("Difference in Means")
ggplot() + geom_histogram(aes(countryAverages)) +
  ggtitle("Distribution of Countries' Average Per Capita Oil Consumption by Year") +
  xlab("Oil Per Capita")
```

Burke

Which countries have had the most dramatic change in generation of hydro power from 1960 to 2010 (In a 50 year period)? Did any countries actually decrease hydro power from 1960 to 2010?

```{r}
hydro <- read.csv("hydro_power_generation_total.csv")
hydro <- na.omit(hydro) #I only want to use countries with complete data sets for each year.#
hydro <- hydro %>% select(country, X1960, X2010) %>% mutate(Diff = X2010 - X1960)
hydro



```

David

How has employment rate changed from 1991 to 2015 for Asian countries? Answering this question can give us insight as to how employment has changed between generations. For this study, I will be analyzing the employment rate of Japan.

Null Hypothesis: Japan's employment rate has not significantly changed compared to other Asian countries.

Japan's change in employment rate from 1991 to 2015 is -4.6%, which is indicated by the red line in the histogram below. This value falls between the 5th and 95th percentile. Therefore we fail to reject the null hypothesis and conclude that Japan's change in employment rate is not significant when compared to other countrys' changes in employment rates.

```{r}

#read the data set and rename the years
employment.rate <- read.csv("aged_15plus_employment_rate_percent.csv")
colnames(employment.rate) <- c('Country', 1991:2022)

#tidy the data and select the years 1991 and 2015
employment.rate.9115 <- select(employment.rate, 'Country', 2, 26)
employment.rate.9115 <- gather(employment.rate.9115, `1991`, `2015`, key = 'year', value = 'eRate')

#filter by Asian Countries

employment.rate.9115.Asia <- filter(employment.rate.9115,
          Country == 'Afghanistan' | Country == 'Armenia' | Country == 'Azerbaijan' | Country == 'Bahrain' | 
          Country == 'Bangladesh' | Country == 'Bhutan' | Country == 'Brunei' | Country == 'Cambodia' | 
          Country == 'China' | Country == 'Cyprus' | Country == 'Georgia' | Country == 'India' | 
          Country == 'Indonesia' | Country == 'Iran' | Country == 'Iraq' | Country == 'Israel' | Country == 'Japan' |
          Country == 'Jordan' | Country == 'Kazakhstan' | Country == 'Kuwait' | Country == 'Kyrgyzstan' | 
          Country == 'Laos' | Country == 'Lebanon' | Country == 'Malaysia' | Country == 'Maldives' | 
          Country == 'Mongolia' | Country == 'Myanmar' | Country == 'Nepal' | Country == 'North Korea' | 
          Country == 'Oman' | Country == 'Pakistan' | Country == 'Palestine' | Country == 'Philippines' |
          Country == 'Qatar' | Country == 'Russia' | Country == 'Saudi Arabia' | Country == 'Singapore' | 
          Country == 'South Korea' | Country == 'Sri Lanka' | Country == 'Syria' | Country == 'Taiwan' | 
          Country == 'Tajikistan' | Country == 'Thailand' | Country == 'Timor-Leste' | Country == 'Turkey' | 
          Country == 'Turkmenistan' | Country == 'United Arab Emirates' | Country == 'Uzbekistan' | 
          Country == 'Vietnam' | Country == 'Yemen')

#first make a function that grabs a random 2015 value
  #get a data set consisting of employment rates from 2015
employment.rate.15.Asia <- filter(employment.rate.9115.Asia, year == 2015) %>% select(eRate)


#second make a function that grabs a randome 1991 value 
employment.rate.91.Asia <- filter(employment.rate.9115.Asia, year == 1991) %>% select(eRate)

#grab those values and subtract them in a loop

#now make a for loop with these functions

vector.9115 <- vector("double", length = 1000)
for(i in seq_along(vector.9115)){
  vector.9115[i] <- sample_n(employment.rate.15.Asia, 1)-sample_n(employment.rate.91.Asia, 1)
}

#make its a data frame
new.df<- unlist(vector.9115)

#get percentiles
quantile(new.df,c(.05, .95)) # -28.2 and 29.62 for 5th and 95th percentiles

#get japan data
  #2015: 58%, #1991:62.6%, difference = -4.6%

#histogram with relevent data

ggplot() + geom_histogram(aes(new.df), bins = 50)  +
  geom_vline(xintercept = -28.2) +
  geom_vline(xintercept = 29.62) +
  geom_vline(xintercept = -4.6, color = "red") +
  xlab("2015 Employment Rate - 1991 Employment Rate") +
  ggtitle("Distribution of Asian Countries' Employment Rate Difference from 1991 to 2015")

```




