---
title: "Data Betas Lab 13"
author: "Brandon Nelsen. David Washburn, Burke Parent, Drew Hoffman, Tanner Ball"
date: "2019/11/24"
output: html_document
---
```{r}
#Lab Tasks

#Each lab member should come up with and address a subquestion, and then each team should consolidate the findings and choose a single overall question that is most interesting.

#Each team member will be required to perform a permutation test so each team member should choose a subquestion that lends itself to being analyzed via a permutation test.

#Each team member will also be required to use at least one map function in their analysis from section 21.5 in R for Data Science. This does not have to be the main finding, but can be part of the exploratory analysis.

#Note that you may investigate other data sets if you feel that they pose more interesting questions. As long as you perform the above tasks in your analysis, any data sets from gapminder are okay to explore.
```



```{r, include = F, echo = F}
library(tidyverse)
library(gapminder)
library(purrr)
```

Drew 

Do countries with higher life expectancy use more or less oil per capita than countries with a lower life expectancy?

```{r}
oilPerCap <- read.csv("oil_consumption_per_cap.csv")
oilPerCap_noNA <- na.omit(oilPerCap)

countryAverages <- map_dbl(oilPerCap_noNA, mean)

lifeExp <- gapminder %>%
  filter(year == 2007)
#I picked 3 countries from each category, high life expectancy and low life expectancy and plotted them against each other
#High life exp: Japan, Switzerland, Canada
#Low life exp: Trinidad and Tobago, South Africa, 
```

Burke

Which countries have had the most dramatic change in generation of hydro power from 1960 to 2010 (In a 50 year period)? Did any countries actually decrease hydro power from 1960 to 2010?

```{r}
hydro <- read.csv("hydro_power_generation_total.csv")
hydro <- na.omit(hydro) #I only want to use countries with complete data sets for each year.#
hydro <- hydro %>% select(country, X1960, X2010) %>% mutate(Diff = X2010 - X1960)
hydro



```

David

How has employment rate changed from 1991 to 2015 for Asian countries? Answering this question can give us insight as to how employment has changed between generations. For this study, I will be analyzing the employment rate of Japan.

Null Hypothesis: Japan's employment rate has not significantly changed compared to other Asian countries.

Japan's change in employment rate from 1991 to 2015 is -4.6%, which is indicated by the red line in the histogram below. This value falls between the 5th and 95th percentile. Therefore we fail to reject the null hypothesis and conclude that Japan's change in employment rate is not significant when compared to other countrys' changes in employment rates.

```{r}

#read the data set and rename the years
employment.rate <- read.csv("aged_15plus_employment_rate_percent.csv")
colnames(employment.rate) <- c('Country', 1991:2022)

#tidy the data and select the years 1991 and 2015
employment.rate.9115 <- select(employment.rate, 'Country', 2, 26)
employment.rate.9115 <- gather(employment.rate.9115, `1991`, `2015`, key = 'year', value = 'eRate')

#filter by Asian Countries

employment.rate.9115.Asia <- filter(employment.rate.9115,
          Country == 'Afghanistan' | Country == 'Armenia' | Country == 'Azerbaijan' | Country == 'Bahrain' | 
          Country == 'Bangladesh' | Country == 'Bhutan' | Country == 'Brunei' | Country == 'Cambodia' | 
          Country == 'China' | Country == 'Cyprus' | Country == 'Georgia' | Country == 'India' | 
          Country == 'Indonesia' | Country == 'Iran' | Country == 'Iraq' | Country == 'Israel' | Country == 'Japan' |
          Country == 'Jordan' | Country == 'Kazakhstan' | Country == 'Kuwait' | Country == 'Kyrgyzstan' | 
          Country == 'Laos' | Country == 'Lebanon' | Country == 'Malaysia' | Country == 'Maldives' | 
          Country == 'Mongolia' | Country == 'Myanmar' | Country == 'Nepal' | Country == 'North Korea' | 
          Country == 'Oman' | Country == 'Pakistan' | Country == 'Palestine' | Country == 'Philippines' |
          Country == 'Qatar' | Country == 'Russia' | Country == 'Saudi Arabia' | Country == 'Singapore' | 
          Country == 'South Korea' | Country == 'Sri Lanka' | Country == 'Syria' | Country == 'Taiwan' | 
          Country == 'Tajikistan' | Country == 'Thailand' | Country == 'Timor-Leste' | Country == 'Turkey' | 
          Country == 'Turkmenistan' | Country == 'United Arab Emirates' | Country == 'Uzbekistan' | 
          Country == 'Vietnam' | Country == 'Yemen')

#first make a function that grabs a random 2015 value
  #get a data set consisting of employment rates from 2015
employment.rate.15.Asia <- filter(employment.rate.9115.Asia, year == 2015) %>% select(eRate)


#second make a function that grabs a randome 1991 value 
employment.rate.91.Asia <- filter(employment.rate.9115.Asia, year == 1991) %>% select(eRate)

#grab those values and subtract them in a loop

#now make a for loop with these functions

vector.9115 <- vector("double", length = 1000)
for(i in seq_along(vector.9115)){
  vector.9115[i] <- sample_n(employment.rate.15.Asia, 1)-sample_n(employment.rate.91.Asia, 1)
}

#make its a data frame
new.df<- unlist(vector.9115)

#get percentiles
quantile(new.df,c(.05, .95)) # -28.2 and 29.62 for 5th and 95th percentiles

#get japan data
  #2015: 58%, #1991:62.6%, difference = -4.6%

#histogram with relevent data

ggplot() + geom_histogram(aes(new.df), bins = 50)  +
  geom_vline(xintercept = -28.2) +
  geom_vline(xintercept = 29.62) +
  geom_vline(xintercept = -4.6, color = "red") +
  xlab("2015 Employment Rate - 1991 Employment Rate") +
  ggtitle("Distribution of Asian Countries' Employment Rate Difference from 1991 to 2015")

```

Brandon 

How has total energy producton changed in South American countires from 1971 to 2008? This question is important because South America has been a greatly developing and changing continent since the 1970s and it can give us an idea about how South American countries will continue to develop. In this exploration I will be analyzing the total energy production in Chile.

Null Hypothesis: Chile's total energy production has changed significantly compared to other South American Countries.

Null Hypothesis Rejection: Chile's total energy production from 1971 to 2008 is within the 5% to 95% range meaning it did not siginificantly change compared to other South American Countries.
```{r echo = F}
totalProduction <- read_csv("energy_production_total.csv")

Production <- select(totalProduction, 'country', 13, 50)
Production <- gather(Production, `1971`, `2008`, key = 'year', value = 'total')

ProductionSA <- filter(Production, country == 'Brazil' | country == 'Peru' | country == 'Argentina' | country == 'Colombia' | country == 'Chile' | country == 'Venezuela' | country == 'Bolivia' | country == 'Ecuador' | country == 'Uruguay' | country == 'Paraguay' | country == 'Guyana' | country == 'Suriname' | country == 'French Guiana' | country == 'Aruba' | country == 'Curacao' | country == 'Trinidad and Tobago' | country == 'Carribean Netherlands')

ProductionSA2008 <- ProductionSA %>% filter(year == 2008) %>% select(total)

ProductionSA1971 <- ProductionSA %>% filter(year == 1971) %>% select(total)

test <- vector("double", length = 1000)
for(i in seq_along(test)){
  test[i] <- (sample_n(ProductionSA2008, 1) - sample_n(ProductionSA1971, 1))
}

Unlist <- unlist(test)
quantile(Unlist, c(0.05,0.95))

ggplot()+
  geom_histogram(aes(Unlist), binwidth = 10000)+
  geom_vline(xintercept = -160300) +
  geom_vline(xintercept = 218020) +
  geom_vline(xintercept = 3980, color = "red") +
  ggtitle("Distribution of Total Energy Production in South American Countries")+
  xlab("2008 Production - 1971 Production")
```


